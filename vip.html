<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Produits VIP</title>
    <style>
        body { margin: 0; font-family: Arial, sans-serif; background: #0f172a; color: #fff; }
        .container { max-width: 1100px; margin: auto; padding: 20px; padding-bottom: 80px; }
        h2 { text-align: center; margin-bottom: 20px; }
        .solde-box { text-align: center; background: #020617; padding: 15px; border-radius: 10px; margin-bottom: 30px; border: 1px solid #1e293b; }
        .vip-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; }
        .vip-card { background: #020617; border-radius: 12px; padding: 15px; text-align: center; box-shadow: 0 0 10px rgba(0,0,0,0.5); }
        .vip-card img { width: 100%; height: 140px; object-fit: cover; border-radius: 10px; }
        .vip-card h3 { margin: 10px 0; }
        .vip-card p { margin: 5px 0; font-size: 14px; }
        .vip-card button { margin-top: 10px; width: 100%; padding: 10px; border: none; border-radius: 8px; background: #22c55e; color: #000; font-weight: bold; cursor: pointer; }
        .vip-card button:hover { background: #16a34a; }
    </style>
</head>
<body>

<div class="container">
    <h2>Produits VIP</h2>

    <div class="solde-box">
        <p>Solde actuel</p>
        <h3 id="solde">Chargement...</h3>
    </div>

    <div class="vip-grid">
        <div class="vip-card">
            <img src="IMG_2269.jpeg">
            <h3>VIP 1</h3>
            <p>Prix : 20 000 FC</p>
            <p>Revenu journalier : 3 000 FC</p>
            <p>Durée : 30 jours</p>
            <button onclick="acheterVIP(20000, 'VIP 1')">Acheter</button>
        </div>

        <div class="vip-card">
            <img src="IMG_2270.jpeg">
            <h3>VIP 2</h3>
            <p>Prix : 35 000 FC</p>
            <p>Revenu journalier : 5 200 FC</p>
            <p>Durée : 30 jours</p>
            <button onclick="acheterVIP(35000, 'VIP 2')">Acheter</button>
        </div>

        <div class="vip-card">
            <img src="IMG_2271.jpeg">
            <h3>VIP 3</h3>
            <p>Prix : 90 000 FC</p>
            <p>Revenu journalier : 13 500 FC</p>
            <p>Durée : 30 jours</p>
            <button onclick="acheterVIP(90000, 'VIP 3')">Acheter</button>
        </div>

        <div class="vip-card">
            <img src="IMG_2274.jpeg">
            <h3>VIP 4</h3>
            <p>Prix : 280 000 FC</p>
            <p>Revenu journalier : 42 000 FC</p>
            <p>Durée : 30 jours</p>
            <button onclick="acheterVIP(280000, 'VIP 4')">Acheter</button>
        </div>

        <div class="vip-card">
            <img src="IMG_2275.jpeg">
            <h3>VIP 5</h3>
            <p>Prix : 850 000 FC</p>
            <p>Revenu journalier : 127 500 FC</p>
            <p>Durée : 30 jours</p>
            <button onclick="acheterVIP(850000, 'VIP 5')">Acheter</button>
        </div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, onValue, set, get, push } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    // Configuration strictement identique à votre app.js
    const firebaseConfig = {
        apiKey: "AIzaSyA24pBo8mBWiZssPtep--MMBdB7c8_Lu4U",
        authDomain: "dell-invest.firebaseapp.com",
        projectId: "dell-invest",
        storageBucket: "dell-invest.firebasestorage.app",
        messagingSenderId: "807081599583",
        appId: "1:807081599583:web:e00ec3959bc4acdae031ea"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const userPhone = localStorage.getItem("userPhone");

    // 1. Vérification de la session
    if (!userPhone) {
        window.location.href = "login.html";
    }

    // 2. Affichage du solde en temps réel
    const soldeRef = ref(db, 'users/' + userPhone + '/solde');
    onValue(soldeRef, (snapshot) => {
        const montant = snapshot.val() || 0;
        document.getElementById("solde").innerText = montant + " FC";
    });

    // 3. Fonction Acheter connectée à Firebase
    window.acheterVIP = async function(prix, nomVIP) {
        const userRef = ref(db, 'users/' + userPhone);
        
        try {
            const snapshot = await get(userRef);
            if (snapshot.exists()) {
                let soldeActuel = snapshot.val().solde || 0;

                if (soldeActuel >= prix) {
                    let nouveauSolde = soldeActuel - prix;

                    // Mettre à jour le solde dans la base de données
                    await set(ref(db, 'users/' + userPhone + '/solde'), nouveauSolde);

                    // Enregistrer l'achat pour le contrôle Admin
                    const achatRef = ref(db, 'achats/' + userPhone);
                    await push(achatRef, {
                        produit: nomVIP,
                        prixAchat: prix,
                        date: new Date().toLocaleString()
                    });

                    alert("✅ Achat réussi : " + nomVIP);
                } else {
                    alert("❌ Solde insuffisant ! Rechargez votre compte.");
                }
            }
        } catch (error) {
            console.error(error);
            alert("Erreur lors de la transaction.");
        }
    };
</script>

</body>
</html>

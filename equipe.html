<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mon Équipe - DELL INVEST</title>
    <style>
        body { font-family: sans-serif; background: #f4f7fe; margin: 0; padding-bottom: 80px; }
        .header { background: #1a237e; color: white; padding: 30px; text-align: center; border-radius: 0 0 25px 25px; }
        .stat-card { background: white; margin: 15px; padding: 20px; border-radius: 15px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .invite-box { background: #1e293b; color: white; margin: 15px; padding: 20px; border-radius: 20px; text-align: center; }
        .copy-btn { background: #ffeb3b; padding: 10px; width: 100%; border-radius: 10px; border: none; font-weight: bold; margin-top: 10px; cursor: pointer; }
    </style>
</head>
<body>
    <div class="header"><h2>MON ÉQUIPE</h2></div>

    <div class="invite-box">
        <small>VOTRE CODE : <b id="my-code">---</b></small>
        <div id="full-link" style="font-size: 10px; color: #aaa; margin-top: 10px; word-break: break-all;">Lien de parrainage...</div>
        <button class="copy-btn" onclick="copyLink()">COPIER MON LIEN</button>
    </div>

    <div class="stat-card"><span>Niveau 1 (25%)</span> <b id="n1">0</b></div>
    <div class="stat-card"><span>Niveau 2 (3%)</span> <b id="n2">0</b></div>
    <div class="stat-card"><span>Niveau 3 (1%)</span> <b id="n3">0</b></div>

    <script src="app.js"></script>
    <script>
        window.onload = () => {
            const user = getCurrentUser();
            if (!user) return window.location.href = "login.html";

            const allUsers = JSON.parse(localStorage.getItem("all_users") || "[]");
            
            // 1. Affichage du lien
            const link = window.location.origin + window.location.pathname.replace("equipe.html", "register.html") + "?inviteCode=" + user.myInviteCode;
            document.getElementById("my-code").innerText = user.myInviteCode;
            document.getElementById("full-link").innerText = link;

            // 2. Calcul des niveaux
            const lv1 = allUsers.filter(u => u.referredBy === user.myInviteCode);
            const lv1Codes = lv1.map(u => u.myInviteCode);
            const lv2 = allUsers.filter(u => lv1Codes.includes(u.referredBy));
            const lv2Codes = lv2.map(u => u.myInviteCode);
            const lv3 = allUsers.filter(u => lv2Codes.includes(u.referredBy));

            document.getElementById("n1").innerText = lv1.length;
            document.getElementById("n2").innerText = lv2.length;
            document.getElementById("n3").innerText = lv3.length;
        };

        function copyLink() {
            navigator.clipboard.writeText(document.getElementById("full-link").innerText);
            alert("Lien copié !");
        }
    </script>
</body>
</html>
